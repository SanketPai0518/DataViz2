<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Internet users (% of population), 2021</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    header { padding:16px 20px; font-weight:600; }
    #vis { max-width: 1100px; margin: 0 auto 24px; padding: 0 12px; }
    footer { max-width:1100px; margin: 0 auto 24px; padding: 0 12px; font-size:12px; color:#555; }
  </style>
</head>
<body>
<header>Internet users (% of population), 2021</header>
<div id="vis"></div>
<footer>
  If you swap the GeoJSON URL, this spec will still work as long as it has one of:
  <code>id</code>, <code>properties.ISO_A3</code>, or <code>properties["ISO3166-1-Alpha-3"]</code>.
</footer>

<script>
const spec = {
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1000, "height": 560,
  "projection": {"type":"equalEarth"},

  /* Use YOUR GeoJSON here. If you keep mine, it's fine too. */
  "data": {
    "url": "https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson",
    "format": {"type":"geojson"}
  },

  "transform": [
    /* Create a unified ISO3 code from whichever field exists */
    {
      "calculate":
        "isValid(datum.id) ? datum.id " +
        ": (isValid(datum.properties.ISO_A3) ? datum.properties.ISO_A3 " +
        ": datum.properties['ISO3166-1-Alpha-3'])",
      "as": "iso3"
    },

    /* Join OWID Internet-use dataset by ISO-3 */
    {
      "lookup": "iso3",
      "from": {
        "data": {
          "url": "https://ourworldindata.org/grapher/share-of-individuals-using-the-internet.csv"
        },
        "key": "Code",
        "fields": ["Entity","Year","Individuals using the Internet (% of population)"]
      }
    },

    /* Keep 2021 and valid values */
    {"filter": "datum.Year == 2021"},
    {"filter": "isValid(datum['Individuals using the Internet (% of population)'])"}
  ],

  "mark": {"type":"geoshape"},

  "encoding": {
    "color": {
      "field": "Individuals using the Internet (% of population)",
      "type": "quantitative",
      "title": "Internet users (% of population, 2021)",
      "scale": {"scheme":"blues"}
    },
    "tooltip": [
      {"field":"Entity","title":"Country"},
      {"field":"Individuals using the Internet (% of population)","title":"% online","format":".1f"}
    ]
  },

  "config": {"view":{"stroke":null}, "legend":{"orient":"right"}, "background":"#ffffff"}
};

vegaEmbed("#vis", spec, {actions:false});
</script>
</body>
</html>
